<script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0/dist/fancybox/fancybox.umd.js"></script>

<script>
  // Wait for migroot object to load and then fetch data
  async function waitForMigroot() {
    const timeout = 10000; // maximum time to wait: 10 seconds
    const interval = 100; // check every 100 ms
    let waited = 0;

    if (typeof CONFIG === 'undefined') {
      console.warn("CONFIG is not defined. Skipping Migroot initialization.");
      return;
    }

    while (typeof window.Migroot !== 'function') {
      if (waited >= timeout) {
        throw new Error("Migroot did not load within the expected time.");
      }
      await new Promise(resolve => setTimeout(resolve, interval));
      waited += interval;
    }

    window.mg = new Migroot(CONFIG);
  }
  // Wait for Outseta object to load and then fetch data
  function waitForOutseta() {
    return new Promise((resolve, reject) => {
      const checkOutseta = setInterval(() => {
        if (typeof Outseta !== 'undefined') {
          clearInterval(checkOutseta);
          resolve();
        }
      }, 100);

      setTimeout(() => {
        clearInterval(checkOutseta);
        reject(new Error('Outseta loading error'));
      }, 5000);
    });
  };


async function initDashboard() {
  try {
    const allowedPages = ['app']; // all pages started from app
    const currentPath = window.location.pathname.split('/').filter(Boolean)[0];
    if (!allowedPages.includes(currentPath)) {
      return;
    }

    if (typeof preloaderStart === 'function') {
    	preloaderStart();
    }

    if (!window.mg) {
      throw new Error("Migroot instance (window.mg) is not initialized.");
    }

    await window.mg.init_mg({
      boardId: null,
      callback: (result) => {
        preloaderFinish();
        console.log("Dashboard initialized successfully", result);
      }
     });

  } catch (error) {
    if (typeof preloaderError === 'function') {
      preloaderError(error.message || error);
    }
    console.warn("Migroot init stopped:", error);
  }
}

window.onload = async function () {
    try {
        await waitForOutseta();
        await waitForMigroot();
		await initDashboard();
    } catch (error) {
        console.error("Error during dashboard initializing on window on load:", error);
    }
};

</script>

<script>
  var noscriptTag = document.createElement("noscript");
  noscriptTag.innerHTML = '<iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NV4KXL5V" height="0" width="0" style="display:none;visibility:hidden"></iframe>';

  document.body.insertBefore(noscriptTag, document.body.firstChild);

  Fancybox.bind("[data-fancybox]", {
    // Your custom options
  });


  <!-- INISIALISATION INTERCOM -->
  document.addEventListener('DOMContentLoaded', function() {
    openIntercom();
  });
  <!-- END INISIALISATION INTERCOM -->

  <!-- ADD OG:URL -->
  document.addEventListener("DOMContentLoaded", function () {
    let ogUrlMeta = document.querySelector('meta[property="og:url"]');

    if (!ogUrlMeta) {
      ogUrlMeta = document.createElement('meta');
      ogUrlMeta.setAttribute('property', 'og:url');
      document.head.appendChild(ogUrlMeta);
    }

    ogUrlMeta.setAttribute('content', window.location.href);
  });
  <!-- END ADD OG:URL -->
</script>